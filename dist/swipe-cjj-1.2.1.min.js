/*! swipe-cjj - v1.2.1 - 2020-05-13 */
function Swipe(t){this.id=t.id,this.cas=document.getElementById(this.id),this.context=this.cas.getContext("2d"),this._w=t._w,this._h=t._h,this.radius=t.r,this.posX=0,this.posY=0,this.isMouseDown=!1,this.mask=t.mask,this.coverType=t.coverType,this.percent=t.percent,this.callback=t.callback,this.init(),this.addEvent()}function getAllOffset(t){for(var e=0,o=0;t;)e+=t.offsetTop+t.clientTop,o+=t.offsetLeft+t.clientLeft,t=t.offsetParent;return{allTop:e,allLeft:o}}Swipe.prototype.init=function(){var t,e;this.cas.width=this._w,this.cas.height=this._h,"color"===this.coverType&&(this.context.fillStyle=this.mask,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out"),"img"===this.coverType&&((t=new Image).src=this.mask,e=this,t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out"})},Swipe.prototype.addEvent=function(){var s=this;this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.clickEvent=this.device?"touchstart":"mousedown",this.moveEvent=this.device?"touchmove":"mousemove",this.upEvent=this.device?"touchend":"mouseup",this.cas.addEventListener(this.clickEvent,function(t){s.offsetTop=getAllOffset(s.cas).allTop,s.offsetLeft=getAllOffset(s.cas).allLeft,s.scrollTop=document.documentElement.scrollTop||document.body.scrollTop;var e=t||window.event;s.posX=s.device?e.touches[0].clientX-s.offsetLeft:e.clientX-s.offsetLeft,s.posY=s.device?e.touches[0].clientY-s.offsetTop+s.scrollTop:e.clientY-s.offsetTop+s.scrollTop,s.drawArc(s.posX,s.posY),s.isMouseDown=!0}),this.cas.addEventListener(this.moveEvent,function(t){if(!s.isMouseDown)return!1;var e=t||window.event,o=s.device?e.touches[0].clientX-s.offsetLeft:e.clientX-s.offsetLeft,i=s.device?e.touches[0].clientY-s.offsetTop+s.scrollTop:e.clientY-s.offsetTop+s.scrollTop;s.drawLine(s.context,s.posX,s.posY,o,i,s.r),s.posX=s.device?e.touches[0].clientX-s.offsetLeft:e.clientX-s.offsetLeft,s.posY=s.device?e.touches[0].clientY-s.offsetTop+s.scrollTop:e.clientY-s.offsetTop+s.scrollTop}),this.cas.addEventListener(this.upEvent,function(t){s.isMouseDown=!1;var e=s.getPercentage(s.context,s._w,s._h);e>s.percent&&(s.callback.call(null,e),alert("擦除完成"),s.context.clearRect(0,0,s._w,s._h))})},Swipe.prototype.drawLine=function(t,e,o,i,s,n){t.beginPath(),t.moveTo(e,o),t.lineTo(i,s),t.lineWidth=2*this.radius,t.lineCap="round",t.stroke()},Swipe.prototype.getPercentage=function(t,e,o){for(var i=t.getImageData(0,0,e,o),s=0,n=0;n<i.data.length;n+=4)0===i.data[n+3]&&s++;return s/(e*o)*100},Swipe.prototype.drawArc=function(t,e){this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.restore()};